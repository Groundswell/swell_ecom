
.container
	.row

		= form_for @order, as: :order, url: swell_ecom.confirm_checkout_index_path(), method: 'POST', html: { class: 'stripe_form' } do |f|

			- @order.order_items.each do |order_item|
				- if order_item.sku?
					= hidden_field_tag 'order[order_items][][code]', order_item.item.code
					= hidden_field_tag 'order[order_items][][quantity]', order_item.quantity

			= f.hidden_field :email, class: 'form-control'
			= f.fields_for :billing_address do |billing_address_form|
				= billing_address_form.hidden_field :first_name, class: 'form-control'
				= billing_address_form.hidden_field :last_name, class: 'form-control'
				= billing_address_form.hidden_field :geo_country_id, class: "form-control"
				= billing_address_form.hidden_field :state, class: "form-control"
				= billing_address_form.hidden_field :geo_state_id, class: "form-control"
				= billing_address_form.hidden_field :street, class: 'form-control'
				= billing_address_form.hidden_field :street2, class: 'form-control'
				= billing_address_form.hidden_field :city, class: 'form-control'
				= billing_address_form.hidden_field :zip, class: 'form-control'
				= billing_address_form.hidden_field :phone, class: 'form-control'
			= f.fields_for :shipping_address do |shipping_address_form|
				= shipping_address_form.hidden_field :first_name, class: 'form-control'
				= shipping_address_form.hidden_field :last_name, class: 'form-control'
				= shipping_address_form.hidden_field :geo_country_id, class: "form-control"
				= shipping_address_form.hidden_field :state, class: "form-control"
				= shipping_address_form.hidden_field :geo_state_id, class: "form-control"
				= shipping_address_form.hidden_field :street, class: 'form-control'
				= shipping_address_form.hidden_field :street2, class: 'form-control'
				= shipping_address_form.hidden_field :city, class: 'form-control'
				= shipping_address_form.hidden_field :zip, class: 'form-control'
				= shipping_address_form.hidden_field :phone, class: 'form-control'
			= hidden_field_tag :stripeToken, params[:stripeToken]
			= f.hidden_field :customer_comment, class: 'form-control'

			.col-xs-12.col-md-9
				.row
					.col-xs-12.col-md-6
						%label Billing Address
						.well.well-sm
							%div
								=@order.billing_address.first_name
								=@order.billing_address.last_name
							%div=@order.billing_address.street
							%div
								=@order.billing_address.street2
								&nbsp;
							%div
								#{@order.billing_address.city}, #{(@order.billing_address.geo_state.try(:name) || @order.billing_address.state)} #{@order.billing_address.zip}
							%div=@order.billing_address.geo_country.name
							%div=@order.billing_address.phone
					.col-xs-12.col-md-6
						%label Shipping Address
						.well.well-sm
							%div
								=@order.shipping_address.first_name
								=@order.shipping_address.last_name
							%div=@order.shipping_address.street
							%div
								=@order.shipping_address.street2
								&nbsp;
							%div
								#{@order.shipping_address.city}, #{(@order.shipping_address.geo_state.try(:name) || @order.shipping_address.state)} #{@order.shipping_address.zip}
							%div=@order.shipping_address.geo_country.name
							%div=@order.shipping_address.phone

				%table.table{ style: 'margin-bottom: 2em;' }
					%thead
						%tr
							%th Product
							%th{ style: 'width: 100px' } Price
							%th.text-right{ style: 'width: 100px' } Quantity
					%tbody
						- @order.order_items.each do |order_item|
							- if order_item.sku?
								%tr
									-# %td avatar
									%td
										=order_item.item.name
									%td= number_to_currency order_item.amount.to_f / 100
									%td.text-right
										=order_item.quantity
				- if @order.customer_comment.present?
					%label Comment
					.well.well-sm= @order.customer_comment
				%div
					.pull-left{ style: 'padding-right: 1em;' }
						%input.btn.btn-primary.submit{:type => "submit", :value => "Place Order"}/

					%div{ style: 'font-weight: bold;' }
						Order Total:
						= number_to_currency @order.total.to_f / 100
			.col-xs-12.col-md-3
				.text-center
					%input.btn.btn-primary.submit{:type => "submit", :value => "Place Order"}/

				%div
					.pull-right
						#{number_to_currency @order.order_items.select{ |order_item| order_item.sku? }.sum(&:amount).to_f / 100}
					Items (#{@order.order_items.select{ |order_item| order_item.sku? }.sum(&:quantity)}):
				- @order.order_items.each do |order_item|
					- unless order_item.sku?
						%div
							.pull-right
								#{number_to_currency order_item.amount.to_f / 100}
							#{order_item.label}:
				%div{ style: 'font-weight: bold;' }
					.pull-right
						= number_to_currency @order.total.to_f / 100
					Total:
